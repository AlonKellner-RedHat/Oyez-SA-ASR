# Generated by Claude
"""Abstract downloader protocol for async fetch backends."""

from contextlib import asynccontextmanager
from typing import Any, Protocol

from .models import FetchResult, RequestMetadata


class AsyncDownloader(Protocol):
    """Protocol for async download backends.

    Implementations must provide:
    - fetch: Download a single request
    - is_transient_failure: Check if failure should be retried
    - check_cache: Check if request is cached
    - create_client: Create the async client context manager
    """

    max_retries: int

    def check_cache(self, request: RequestMetadata) -> FetchResult | None:
        """Check cache for a request.

        Args:
            request: The request metadata.

        Returns
        -------
            FetchResult if cached, None otherwise.
        """
        ...

    async def fetch(self, client: Any, request: RequestMetadata) -> FetchResult:
        """Fetch a single request.

        Args:
            client: The async client (httpx.AsyncClient, S3 client, etc.)
            request: The request metadata containing URL and headers.

        Returns
        -------
            FetchResult with success/failure status and data.
        """
        ...

    def is_transient_failure(self, result: FetchResult) -> bool:
        """Check if failure is transient and should be retried.

        Args:
            result: The fetch result to check.

        Returns
        -------
            True if the failure is transient (429, 5xx, connection errors).
        """
        ...

    @asynccontextmanager
    async def create_client(self) -> Any:
        """Create the async client context manager.

        Yields
        ------
            The async client for use in fetch calls.
        """
        ...
        yield None
