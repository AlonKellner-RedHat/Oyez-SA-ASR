# ASR Normalization Plan

> Generated by Cursor – February 2026

This document defines **normalization rules**, **precedence**, and **overall
flow** for converting transcript text into forms that match spoken
pronunciation (for ASR training or alignment). Where a rule is ambiguous, the
normalizer **outputs all options** (e.g. `"Vee" | "Versus"`); a separate
downstream step chooses the option that best matches ASR output.

Interruption handling is also specified: utterances broken by a short
interjection from another speaker are merged into a single utterance.

Reference: [asr_normalization_findings.md](asr_normalization_findings.md) for
verification and exceptions.

---

## 1. Overall flow

Normalization is applied in **phases** in order. Later phases assume earlier
ones have run (e.g. unspoken headers stripped before token-level rules).

| Phase | Name | Purpose |
|-------|------|---------|
| 1 | Structural cleanup | Strip unspoken headers; merge interruptions. |
| 2 | Context classification | Classify ambiguous spans (N-N, "v.", Roman vs acronym). |
| 3 | Token-level rules | Apply substitutions and expansions per rule. |
| 4 | (Optional) Downstream | Choose among multi-option outputs using ASR hypothesis. |

**Input:** Transcript (e.g. JSON with `turns`, each turn: `speaker_id`,
`speaker_name`, `text`).

**Output:** Normalized text per turn (or merged turn). For ambiguous rules,
output may be a **set of variants** or a **marked string** (e.g. delimiter
between options) so the downstream script can pick one.

---

## 2. Phase 1: Structural cleanup

### 2.1 Strip unspoken section headers

- **Detect:** Substrings that are structural labels, not spoken:
  - `ORAL ARGUMENT OF …`, `REBUTTAL OF …`, `RESUMED ORAL ARGUMENT OF …`
  - All-caps lines at turn start that match a known header pattern.
- **Action:** Remove these spans from the turn text (replace with empty or
  trim). Do not normalize their content.
- **Precedence:** Apply first so alignment is not distorted by non-speech.

### 2.2 Interruption merge

- **Pattern:** A sequence of three turns (A, B, C) where:
  - **A:** Utterance **ends with** `--` (dash-dash, or em/en dash).
  - **B:** Utterance by a **different speaker**, and **short** (e.g. word count
    ≤ N, or character count ≤ M; configurable, e.g. N=15, M=80).
  - **C:** Utterance by the **same speaker as A**, and **starts with** `--`.
- **Action:** Merge A and C into a **single utterance** (same speaker), **excluding**
  B. Join A and C by:
  - Removing the trailing `--` from A and the leading `--` from C, and
  - Concatenating with a single space (or no space if C originally had none).
- **Output:** Replace the three turns with two turns: the merged turn (A′ + C′)
  and no turn for B (B is dropped from the normalized transcript). Optionally
  retain B elsewhere (e.g. metadata) for analysis.
- **Precedence:** Apply after stripping unspoken headers, before token-level
  rules, so that the merged text is then normalized by Phase 3.
- **Edge cases:** If multiple consecutive interruptions match (e.g. A--, B1,
  C--, B2, D--), apply greedily or iteratively: merge (A,C) first, then
  consider (merged, D) with B2 as the short middle utterance.

---

## 3. Phase 2: Context classification

These classifications are used in Phase 3 to decide **which** rule (or
multi-option output) applies. No text change in this phase; only tags or
context flags.

| Span / token | Classify as | Used by |
|-------------|-------------|---------|
| `N-N` or `N–M` (digits, dash) | **Vote tally** (e.g. 9-0, 7-2) if context suggests vote (e.g. “vote”, “held”, “decision”). | N-N rule → "N to M" for vote. |
| Same | **Docket/ID** if pattern like term-docket (e.g. 21-1164, 818-105-1-2) or “docket”, “case”, “number”. | N-N rule → digit/dash spoken form. |
| Same | **Number range** if context suggests range (e.g. “employees”, “pages”, “between”). | N-N rule → "N to M". |
| `v.` or `vs.` | **Case citation** if between two capitalized names/abbrevs (e.g. *Parsons v. Bedford*). | v. rule → "Vee". |
| Same | **Versus (standalone)** if transcript already has “versus” or “v.” in non-citation context. | v. rule → "Versus". |
| Roman-like letters (e.g. VII, IV, V-chip, N.O.V.) | **Roman numeral** if Amendment/Circuit/Article (e.g. Seventh Amendment). | Roman rule → ordinal/spelled. |
| Same | **Acronym** if motion name or product (e.g. N.O.V., V-chip). | Acronym rule → letters (En Oh Vee, Vee chip). |
| “No.” | **Negation** if next token is word (I, The, But, Thank, etc.). | No. rule → leave "No.". |
| Same | **Number/citation** if next token is citation (e.g. 96-511, 89-1416). | No. rule → "number". |

When classification is uncertain, **do not** guess; pass the span to Phase 3
with **all applicable options** (see below).

---

## 4. Phase 3: Token-level normalization rules

Rules are listed in **precedence order** within Phase 3. When a span matches
more than one rule, the **first** matching rule wins unless the rule explicitly
outputs multiple options.

### 4.1 Rule table (precedence order)

| # | Rule | Match | Output (single) | Output (ambiguous) |
|---|------|--------|-----------------|--------------------|
| 1 | Unspoken header | (handled in Phase 1) | — | — |
| 2 | Case/docket ID | Term-docket pattern (e.g. 21-1164, 13-1034). | Term as word + second segment by digit group (e.g. "twenty one eleven sixty four"). | — |
| 3 | Vote tally | N-N classified as vote (9-0, 7-2). | "nine to zero", "seven to two". | — |
| 4 | Number range | N-N classified as range (e.g. 6-8 employees). | "six to eight". | — |
| 5 | Docket/ID (other) | N-N or N-N-N-N classified as docket/ID. | Digit/dash spoken (e.g. "Eight Eighteen Dash One Oh Five Dash One Dash Two"). | — |
| 6 | v. / vs. | Token `v.` or `vs.` in case citation (X v. Y). | — | **"Vee" \| "Versus"** |
| 7 | vs. (standalone) | Token `vs.` or phrase “versus” already in text. | Leave "versus". | — |
| 8 | Title Mr./Ms. | `Mr.`, `Ms.`, `Mrs.`. | Mr. → "Mister"; Ms. → "Ms." or "Miz"; Mrs. → "Missus". | Ms.: **"Ms." \| "Miz"** |
| 9 | Years | 4-digit 19xx/20xx. | Spoken year (e.g. "nineteen thirty five", "twenty ten"). | — |
| 10 | Historical year | 4-digit 1xxx (e.g. 1215, 1791). | Year-like ("twelve fifteen", "seventeen ninety one"). | — |
| 11 | Age / small number | Small number in age-like context. | Spoken number (e.g. "ninety four", "twelve"). | — |
| 12 | Currency | `$` + number. | Spoken number + "dollars" (e.g. "forty thousand dollars"). | — |
| 13 | Section number (legal) | "Section" + digits, or standalone 3–4 digit in legal context. | Digit-style, "oh" for zero (e.g. "Section Eight Oh Two"). | — |
| 14 | Statute citation | "N U.S.C.", "Title N", code like 16-1501. | "twenty one U S C", "Title eighteen"; code digit-style. | — |
| 15 | Acronyms (letter) | Known acronym (BIA, USC, SEC, N.O.V., etc.). | Letter-by-letter (e.g. "Bee I Ay", "Ess Ee Cee", "En Oh Vee"). | — |
| 16 | Acronym (word) | Known word-pronunciation (e.g. WOS). | "Woes". | — |
| 17 | Roman numeral | VII, IV, etc. in Amendment/Circuit/Article context. | Ordinal or spelled ("Seventh", "fourth"). | — |
| 18 | Roman vs acronym | Same letters as Roman but context = motion/product (N.O.V., V-chip). | — | N.O.V.: **"En Oh Vee"**; V-chip: **"Vee chip"** (no extra option). |
| 19 | “No.” (negation) | "No." next token word. | Leave "No.". | — |
| 20 | “No.” (number/citation) | "No." next token citation. | "number" + rest (e.g. "number ninety six five eleven"). | — |
| 21 | Percentage | `N%` or "N percent". | Spoken number + "percent" (e.g. "fifty percent", "Seventy percent"). | — |
| 22 | Decade | 19xxs, 20xxs. | Spoken (e.g. "nineteen eighties", "Nineteen Sixties"). | — |
| 23 | Ordinal (word) | Fifth, Seventh, Eighth, etc. | Keep or lowercase (e.g. "fifth", "Seventh"). | — |
| 24 | Et al. | "et al.". | — | **"et al." \| "and others"** |
| 25 | Quote marks / Unicode | Curly quotes, em dash, ellipsis. | Straight quote; dash → hyphen or "to"; ellipsis omit. | Optional. |
| 26 | Leading decimal | .N (not year). | "point" + digits (e.g. "point six six"). | — |
| 27 | Non-speech brackets | (Inaudible), [Laughter], [cough], etc. | Strip. | — |
| 28 | Editorial [= X] | [= Mr.], [= 1983]. | Replace with normalized X, then strip brackets. | — |

### 4.2 Multi-option output format

When a rule outputs **multiple options** (e.g. v. → "Vee" | "Versus"), the
normalizer should produce a representation that a downstream script can
parse, for example:

- **Delimiter:** `"Vee" | "Versus"` (pipe-separated inside the string), or
- **Structured:** A list/set of variants per span, e.g. `["Vee", "Versus"]`.

The downstream step (separate script) compares each option to the ASR
hypothesis (e.g. word error rate or alignment score) and selects the best
match.

### 4.3 Precedence within Phase 3

- **Context-dependent rules** (N-N, "v.", Roman vs acronym) use the
  classification from Phase 2. If classification yields multiple possible
  types, output **all** corresponding options (e.g. for "v." output
  "Vee" | "Versus").
- **First match:** For a given span, apply the **first** rule in the table that
  matches. Exception: when the rule cell says "Output (ambiguous)", emit all
  options and do not apply a later rule to the same span for that purpose.
- **Order of application:** Scan text (e.g. left-to-right or by token). For
  each span, if it matches rule K, apply K; then advance past the span and
  continue. Overlapping matches (e.g. "21-1164" as both case ID and number
  range) are resolved by rule order: case/docket (2) before number range (4)
  when pattern matches case ID.

---

## 5. Interruption handling (detail)

### 5.1 Definition

- **Utterance A:** Any turn whose `text` ends with `--` (two ASCII hyphens or
  one em/en dash at end after optional whitespace).
- **Short utterance B:** A turn by a **different** speaker than A, with length
  below a threshold (e.g. ≤ 15 words or ≤ 80 characters). Threshold is
  configurable.
- **Utterance C:** A turn by the **same** speaker as A whose `text` starts
  with `--` (after optional leading whitespace).

### 5.2 Merge algorithm

1. Iterate over the list of turns in order.
2. At each turn A (speaker S_A) that ends with `--`:
   - Look at next turn B (speaker S_B ≠ S_A). If B is missing or not short,
     skip.
   - Look at next turn C (speaker S_C). If S_C ≠ S_A or C does not start with
     `--`, skip.
   - Merge: new text = `trim_end_dash(A.text) + " " + trim_start_dash(C.text)`.
   - Replace A with merged turn (same speaker, new text, timestamps can be
     A.start to C.end). Remove B and C from the list (or mark B as
     “interruption”, C merged into A).
   - Advance so the next iteration does not use C again.

### 5.3 Edge cases

- **Multiple dashes:** Treat “--” as one interruption marker; allow optional
  trailing/leading spaces.
- **Same speaker B:** If B is same speaker as A, do not treat as interruption
  (no merge).
- **Long B:** If B exceeds the “short” threshold, do not merge (A and C remain
  separate).

---

## 6. Summary

| Phase | What runs | Output |
|-------|-----------|--------|
| 1 | Strip unspoken headers; merge interruptions (A--, B short, C--). | Cleaned turns. |
| 2 | Classify N-N, v., Roman vs acronym, “No.” context. | Context tags. |
| 3 | Apply token-level rules in table order; emit multi-option where specified. | Normalized text (or options). |
| 4 | (Separate script) Resolve options using ASR output. | Final normalized form. |

Reference: [asr_normalization_findings.md](asr_normalization_findings.md) for
verified examples and exceptions (e.g. document IDs, code citations, typos).
