env_list = [ "py313", "path", "coverage", "hf-v4", "hf-v3" ]

[env_run_base]
runner = "uv-venv-lock-runner"
description = "Run test under {base_python}"
skip_install = true
commands = [
  [
    "uv",
    "run",
    "pytest",
    { replace = "posargs", default = [ "tests" ], extend = true },
  ],
]

[env.path]
base_python = [ "py313" ]
commands = [
  [
    "uv",
    "run",
    "pytest",
    { replace = "posargs", default = [ "tests" ], extend = true },
  ],
]

[env.coverage]
base_python = [ "py313" ]
commands = [
  [
    "uv",
    "run",
    "pytest",
    "tests",
    "-m",
    "not slow",
    "--cov",
    "--cov-report=term-missing",
    "--cov-report=lcov:lcov.info",
    "--cov=src/oyez_sa_asr",
    "--cov-fail-under=94",
  ],
]

# HuggingFace datasets v4.x environment (parquet auto-discovery)
[env.hf-v4]
description = "Test with HuggingFace datasets v4.x"
base_python = [ "py313" ]
runner = "uv-venv-runner"
deps = [
  "datasets>=4.0",
  "pytest",
  "pytest-asyncio",
  "packaging",
  "pyarrow",
  "av",
  "numpy",
]
commands = [
  [ "pytest", "tests/test_hf_compat.py", "tests/test_loaders_hf.py", "tests/test_hf_v4.py", "-v" ],
]

# HuggingFace datasets v3.x environment (loading scripts)

[env.hf-v3]
description = "Test with HuggingFace datasets v3.x"
base_python = [ "py313" ]
runner = "uv-venv-runner"
deps = [
  "datasets>=3.0,<4.0",
  "pytest",
  "pytest-asyncio",
  "packaging",
  "pyarrow",
  "av",
  "numpy",
  "librosa",
  "soundfile",
]
commands = [
  [ "pytest", "tests/test_hf_compat.py", "tests/test_loaders_hf.py", "tests/test_hf_v3.py", "-v" ],
]
