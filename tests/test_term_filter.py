# Generated by Claude
"""Tests for term_filter module."""

from pathlib import Path

from oyez_sa_asr.term_filter import filter_by_terms, filter_dirs


class TestFilterByTerms:
    """Tests for filter_by_terms function."""

    def test_returns_all_when_terms_none(self) -> None:
        """Returns all items when terms is None."""
        items = [("2020", "a"), ("2021", "b"), ("2022", "c")]
        result = filter_by_terms(items, lambda x: x[0], None)
        assert result == items

    def test_returns_all_when_terms_empty(self) -> None:
        """Returns all items when terms is empty list."""
        items = [("2020", "a"), ("2021", "b")]
        result = filter_by_terms(items, lambda x: x[0], [])
        assert result == items

    def test_filters_single_term(self) -> None:
        """Filters to single term."""
        items = [("2020", "a"), ("2021", "b"), ("2022", "c")]
        result = filter_by_terms(items, lambda x: x[0], ["2021"])
        assert result == [("2021", "b")]

    def test_filters_multiple_terms(self) -> None:
        """Filters to multiple terms."""
        items = [("2020", "a"), ("2021", "b"), ("2022", "c")]
        result = filter_by_terms(items, lambda x: x[0], ["2020", "2022"])
        assert result == [("2020", "a"), ("2022", "c")]

    def test_preserves_order(self) -> None:
        """Preserves original item order."""
        items = [("2022", "c"), ("2020", "a"), ("2021", "b")]
        result = filter_by_terms(items, lambda x: x[0], ["2020", "2021", "2022"])
        assert result == items

    def test_handles_no_matches(self) -> None:
        """Returns empty list when no matches."""
        items = [("2020", "a"), ("2021", "b")]
        result = filter_by_terms(items, lambda x: x[0], ["2025"])
        assert result == []

    def test_works_with_dicts(self) -> None:
        """Works with dict items."""
        items = [{"term": "2020"}, {"term": "2021"}, {"term": "2022"}]
        result = filter_by_terms(items, lambda x: x["term"], ["2021"])
        assert result == [{"term": "2021"}]

    def test_works_with_paths(self) -> None:
        """Works with path-like items."""
        items = [Path("2020/a.json"), Path("2021/b.json"), Path("2022/c.json")]
        result = filter_by_terms(items, lambda x: x.parts[0], ["2021"])
        assert result == [Path("2021/b.json")]


class TestFilterDirs:
    """Tests for filter_dirs helper."""

    def test_filters_directories_by_term(self, tmp_path: Path) -> None:
        """Filters directories by term name."""
        # Create term directories
        (tmp_path / "2020").mkdir()
        (tmp_path / "2021").mkdir()
        (tmp_path / "2022").mkdir()
        (tmp_path / "other").mkdir()

        all_dirs = list(tmp_path.iterdir())
        result = filter_dirs(all_dirs, ["2020", "2022"])
        names = sorted(d.name for d in result)
        assert names == ["2020", "2022"]

    def test_returns_all_when_none(self, tmp_path: Path) -> None:
        """Returns all dirs when terms is None."""
        (tmp_path / "2020").mkdir()
        (tmp_path / "2021").mkdir()

        all_dirs = list(tmp_path.iterdir())
        result = filter_dirs(all_dirs, None)
        assert len(result) == 2
