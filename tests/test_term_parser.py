# Generated by Claude
"""Tests for term parser with ranges, abbreviations, and comma-separated lists."""

import pytest

from oyez_sa_asr.term_parser import (
    expand_abbreviation,
    parse_range,
    parse_term_list,
    parse_terms,
)


class TestExpandAbbreviation:
    """Tests for abbreviation expansion."""

    def test_full_year(self) -> None:
        """Full 4-digit year should pass through."""
        assert expand_abbreviation("1998") == "1998"
        assert expand_abbreviation("2022") == "2022"

    def test_two_digit_abbreviation_00_50(self) -> None:
        """00-50 should expand to 2000-2050."""
        assert expand_abbreviation("00") == "2000"
        assert expand_abbreviation("50") == "2050"
        assert expand_abbreviation("22") == "2022"

    def test_two_digit_abbreviation_51_99(self) -> None:
        """51-99 should expand to 1951-1999."""
        assert expand_abbreviation("51") == "1951"
        assert expand_abbreviation("99") == "1999"
        assert expand_abbreviation("98") == "1998"

    def test_invalid_abbreviation(self) -> None:
        """Invalid abbreviations should raise ValueError."""
        with pytest.raises(ValueError):
            expand_abbreviation("abc")
        with pytest.raises(ValueError):
            expand_abbreviation("12345")


class TestParseRange:
    """Tests for range parsing."""

    def test_simple_range(self) -> None:
        """Parse simple range."""
        assert parse_range("1998-2000") == ["1998", "1999", "2000"]

    def test_abbreviated_range(self) -> None:
        """Parse range with abbreviations."""
        assert parse_range("98-00") == ["1998", "1999", "2000"]
        assert parse_range("2020-22") == ["2020", "2021", "2022"]

    def test_cross_century_range(self) -> None:
        """Parse cross-century range."""
        assert parse_range("99-01") == ["1999", "2000", "2001"]

    def test_invalid_range(self) -> None:
        """Invalid ranges should raise ValueError."""
        with pytest.raises(ValueError):
            parse_range("invalid")
        with pytest.raises(ValueError):
            parse_range("2000-1998")


class TestParseTerms:
    """Tests for term string parsing."""

    def test_single_term(self) -> None:
        """Parse single term."""
        assert parse_terms("1998") == ["1998"]
        assert parse_terms("98") == ["1998"]

    def test_comma_separated(self) -> None:
        """Parse comma-separated terms."""
        assert parse_terms("1998,2022") == ["1998", "2022"]
        assert parse_terms("98,22") == ["1998", "2022"]

    def test_range(self) -> None:
        """Parse range."""
        assert parse_terms("98-00") == ["1998", "1999", "2000"]

    def test_mixed(self) -> None:
        """Parse mixed formats."""
        assert parse_terms("98-00,22") == ["1998", "1999", "2000", "2022"]
        assert parse_terms("1998,99-00,2022") == ["1998", "1999", "2000", "2022"]

    def test_empty_string(self) -> None:
        """Empty string should raise ValueError."""
        with pytest.raises(ValueError):
            parse_terms("")


class TestParseTermList:
    """Tests for term list parsing."""

    def test_none(self) -> None:
        """None should return None."""
        assert parse_term_list(None) is None
        assert parse_term_list([]) is None

    def test_single_item(self) -> None:
        """Parse single item list."""
        assert parse_term_list(["1998"]) == ["1998"]
        assert parse_term_list(["98"]) == ["1998"]

    def test_multiple_items(self) -> None:
        """Parse multiple items."""
        assert parse_term_list(["1998", "2022"]) == ["1998", "2022"]
        assert parse_term_list(["98-00", "22"]) == ["1998", "1999", "2000", "2022"]

    def test_deduplication(self) -> None:
        """Should deduplicate terms."""
        assert parse_term_list(["1998", "1998", "2022"]) == ["1998", "2022"]
