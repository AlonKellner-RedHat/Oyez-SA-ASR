# Generated by Claude
"""Tests for parser type classes (TDD)."""

from oyez_sa_asr.scraper.parser import (
    CaseSummary,
    Citation,
    TimelineEvent,
    unix_timestamp_to_iso,
)


class TestUnixTimestampToIso:
    """Tests for unix_timestamp_to_iso function."""

    def test_positive_timestamp(self) -> None:
        """Should convert positive Unix timestamp to ISO date."""
        result = unix_timestamp_to_iso(1579046400)
        assert result == "2020-01-15"

    def test_negative_timestamp(self) -> None:
        """Should convert negative Unix timestamp (before 1970) to ISO date."""
        result = unix_timestamp_to_iso(-124826400)
        assert result == "1966-01-17"

    def test_none_timestamp(self) -> None:
        """Should return None for None input."""
        assert unix_timestamp_to_iso(None) is None


class TestTimelineEvent:
    """Tests for TimelineEvent dataclass."""

    def test_from_raw(self) -> None:
        """Should parse raw timeline event dict."""
        raw = {"event": "Argued", "dates": [1579046400]}
        event = TimelineEvent.from_raw(raw)
        assert event.event == "Argued"
        assert event.date == "2020-01-15"

    def test_from_raw_negative_date(self) -> None:
        """Should handle negative timestamps."""
        raw = {"event": "Decided", "dates": [-124826400]}
        event = TimelineEvent.from_raw(raw)
        assert event.event == "Decided"
        assert event.date == "1966-01-17"

    def test_to_dict(self) -> None:
        """Should serialize to dict."""
        event = TimelineEvent(event="Argued", date="2020-01-15")
        assert event.to_dict() == {"event": "Argued", "date": "2020-01-15"}


class TestCitation:
    """Tests for Citation dataclass."""

    def test_from_raw(self) -> None:
        """Should parse raw citation dict."""
        raw = {"volume": "382", "page": "372", "year": "1966"}
        citation = Citation.from_raw(raw)
        assert citation.volume == "382"
        assert citation.page == "372"
        assert citation.year == "1966"

    def test_from_raw_none(self) -> None:
        """Should return None for None input."""
        assert Citation.from_raw(None) is None

    def test_to_dict(self) -> None:
        """Should serialize to dict."""
        citation = Citation(volume="382", page="372", year="1966")
        assert citation.to_dict() == {"volume": "382", "page": "372", "year": "1966"}


class TestCaseSummary:
    """Tests for CaseSummary dataclass."""

    def test_from_raw(self) -> None:
        """Should parse raw case dict from API response."""
        raw = {
            "ID": 49051,
            "name": "Test Case v. United States",
            "href": "https://api.oyez.org/cases/1966/510",
            "docket_number": "510",
            "term": "1966",
            "citation": {"volume": "382", "page": "372", "year": "1966"},
            "timeline": [{"event": "Decided", "dates": [-124826400]}],
            "question": "Is this a test?",
            "description": "A test case",
            "justia_url": "https://supreme.justia.com/cases/federal/us/382/372/",
        }
        case = CaseSummary.from_raw(raw)

        assert case.id == 49051
        assert case.name == "Test Case v. United States"
        assert case.citation is not None
        assert case.citation.volume == "382"
        assert len(case.timeline) == 1

    def test_from_raw_with_nulls(self) -> None:
        """Should handle null fields gracefully."""
        raw = {
            "ID": 123,
            "name": "Minimal Case",
            "href": "https://api.oyez.org/cases/2020/1",
            "docket_number": "1",
            "term": "2020",
            "citation": None,
            "timeline": [],
            "question": None,
            "description": None,
            "justia_url": None,
        }
        case = CaseSummary.from_raw(raw)

        assert case.id == 123
        assert case.citation is None
        assert case.timeline == []

    def test_from_raw_with_none_timeline_entries(self) -> None:
        """Should skip None entries in timeline array."""
        raw = {
            "ID": 456,
            "name": "Case with None timeline",
            "href": "https://api.oyez.org/cases/2020/2",
            "docket_number": "2",
            "term": "2020",
            "citation": None,
            "timeline": [
                {"event": "Argued", "dates": [1579046400]},
                None,
                {"event": "Decided", "dates": [1579132800]},
            ],
            "question": None,
            "description": None,
            "justia_url": None,
        }
        case = CaseSummary.from_raw(raw)

        assert len(case.timeline) == 2
        assert case.timeline[0].event == "Argued"
        assert case.timeline[1].event == "Decided"

    def test_to_dict(self) -> None:
        """Should serialize to dict for JSON output."""
        case = CaseSummary(
            id=123,
            name="Test",
            href="https://example.com",
            docket_number="1",
            term="2020",
            citation=Citation(volume="1", page="1", year="2020"),
            timeline=[TimelineEvent(event="Decided", date="2020-01-15")],
            question=None,
            description=None,
            justia_url=None,
        )
        result = case.to_dict()

        assert result["id"] == 123
        assert result["citation"] == {"volume": "1", "page": "1", "year": "2020"}
